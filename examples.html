<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps Examples - Linux Command Handbook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --terminal-bg: #1a1a1a;
            --terminal-green: #00ff41;
            --terminal-amber: #ffd700;
            --terminal-gray: #8a8a8a;
            --terminal-red: #dc143c;
            --terminal-blue: #0066cc;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--terminal-bg);
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .terminal-font {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .example-card {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid rgba(0, 255, 65, 0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .example-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 65, 0.2);
            border-color: var(--terminal-green);
        }
        
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--terminal-green);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
        }
        
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.6s ease;
        }
        
        .difficulty-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
        }
        
        .difficulty-beginner {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .difficulty-intermediate {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }
        
        .difficulty-advanced {
            background: rgba(220, 20, 60, 0.2);
            color: #dc143c;
        }
        
        .copy-btn {
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            color: var(--terminal-green);
            transform: scale(1.1);
        }
        
        pre[class*="language-"] {
            background: #2d2d2d !important;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
            max-height: 400px;
        }
        
        .expand-btn {
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid rgba(0, 255, 65, 0.3);
            color: var(--terminal-green);
            transition: all 0.3s ease;
        }
        
        .expand-btn:hover {
            background: rgba(0, 255, 65, 0.2);
            transform: translateY(-1px);
        }
        
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .collapsible-content.expanded {
            max-height: 1000px;
        }
        
        .scenario-filter {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .scenario-filter.active {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--terminal-amber);
            color: var(--terminal-amber);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-black bg-opacity-90 backdrop-blur-md border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-green-500 rounded flex items-center justify-center">
                        <span class="text-black font-bold text-sm">$</span>
                    </div>
                    <span class="terminal-font text-green-400 font-bold text-xl">LinuxCmd</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="index.html" class="nav-link text-gray-300 hover:text-green-300 px-3 py-2">Search</a>
                    <a href="commands.html" class="nav-link text-gray-300 hover:text-green-300 px-3 py-2">Commands</a>
                    <a href="scripting.html" class="nav-link text-gray-300 hover:text-green-300 px-3 py-2">Scripting</a>
                    <a href="examples.html" class="nav-link text-green-400 hover:text-green-300 px-3 py-2">Examples</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <section class="pt-24 pb-12 bg-gray-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-6xl font-bold mb-4">
                    <span class="terminal-font text-green-400">DevOps</span>
                    <span class="text-white">Examples</span>
                </h1>
                <p class="text-xl text-gray-400">Production-ready scripts and real-world scenarios</p>
            </div>
            
            <!-- Scenario Filters -->
            <div class="flex flex-wrap justify-center gap-4 mb-8">
                <button class="scenario-filter active px-6 py-2 rounded-lg font-medium" data-filter="all">All Examples</button>
                <button class="scenario-filter px-6 py-2 rounded-lg font-medium text-gray-400" data-filter="monitoring">Monitoring</button>
                <button class="scenario-filter px-6 py-2 rounded-lg font-medium text-gray-400" data-filter="backup">Backup</button>
                <button class="scenario-filter px-6 py-2 rounded-lg font-medium text-gray-400" data-filter="deployment">Deployment</button>
                <button class="scenario-filter px-6 py-2 rounded-lg font-medium text-gray-400" data-filter="security">Security</button>
                <button class="scenario-filter px-6 py-2 rounded-lg font-medium text-gray-400" data-filter="automation">Automation</button>
            </div>
        </div>
    </section>

    <!-- Examples Grid -->
    <section class="py-12 bg-black">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="examples-grid" class="space-y-8">
                <!-- Examples will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black py-12 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex items-center justify-center space-x-2 mb-4">
                <div class="w-8 h-8 bg-green-500 rounded flex items-center justify-center">
                    <span class="text-black font-bold text-sm">$</span>
                </div>
                <span class="terminal-font text-green-400 font-bold text-xl">LinuxCmd</span>
            </div>
            <p class="text-gray-400 mb-4">Master Linux commands and shell scripting for DevOps excellence</p>
            <p class="text-gray-500 text-sm">Â© 2025 Linux Command Handbook. Built for theDevOps community. build by @Chandra583*</p>
        </div>
    </footer>

    <script>
        // Examples database
        const examples = [
            {
                title: "System Health Monitor",
                category: "monitoring",
                difficulty: "intermediate",
                description: "Comprehensive system monitoring script with alerting",
                features: ["CPU monitoring", "Memory usage tracking", "Disk space alerts", "Service status checks"],
                code: `#!/bin/bash
# system_health_monitor.sh - Comprehensive system monitoring

THRESHOLD_CPU=80
THRESHOLD_MEM=85
THRESHOLD_DISK=90
ALERT_EMAIL="devops@company.com"
LOG_FILE="/var/log/system_monitor.log"

# Logging function
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# Alert function
send_alert() {
    local subject="$1"
    local message="$2"
    echo "$message" | mail -s "$subject" "$ALERT_EMAIL" 2>/dev/null || \
        log "ERROR: Failed to send email alert"
}

# Check CPU usage
check_cpu() {
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    CPU_USAGE=${CPU_USAGE%.*}
    
    if [ "$CPU_USAGE" -gt "$THRESHOLD_CPU" ]; then
        log "WARNING: CPU usage is ${CPU_USAGE}%"
        send_alert "High CPU Alert on $(hostname)" \
            "CPU usage is ${CPU_USAGE}% on $(hostname) at $(date)"
    else
        log "OK: CPU usage is ${CPU_USAGE}%"
    fi
}

# Check memory usage
check_memory() {
    MEM_USAGE=$(free | grep Mem | awk '{print ($3/$2) * 100.0}')
    MEM_USAGE=${MEM_USAGE%.*}
    
    if [ "$MEM_USAGE" -gt "$THRESHOLD_MEM" ]; then
        log "WARNING: Memory usage is ${MEM_USAGE}%"
        send_alert "High Memory Alert on $(hostname)" \
            "Memory usage is ${MEM_USAGE}% on $(hostname) at $(date)"
    else
        log "OK: Memory usage is ${MEM_USAGE}%"
    fi
}

# Check disk usage
check_disk() {
    while IFS= read -r line; do
        USAGE=$(echo "$line" | awk '{print $5}' | sed 's/%//')
        PARTITION=$(echo "$line" | awk '{print $6}')
        
        if [ "$USAGE" -gt "$THRESHOLD_DISK" ]; then
            log "WARNING: Disk usage on $PARTITION is ${USAGE}%"
            send_alert "High Disk Alert on $(hostname)" \
                "Disk usage on $PARTITION is ${USAGE}% on $(hostname) at $(date)"
        else
            log "OK: Disk usage on $PARTITION is ${USAGE}%"
        fi
    done < <(df -h | grep -vE '^Filesystem|tmpfs|cdrom' | awk '{print $5 " " $6}')
}

# Check critical services
check_services() {
    SERVICES=("nginx" "docker" "postgresql" "redis")
    
    for service in "${SERVICES[@]}"; do
        if systemctl is-active --quiet "$service"; then
            log "OK: $service is running"
        else
            log "CRITICAL: $service is not running"
            send_alert "Service Down Alert on $(hostname)" \
                "$service is down on $(hostname) at $(date)"
            
            # Attempt to restart service
            systemctl restart "$service"
            sleep 5
            
            if systemctl is-active --quiet "$service"; then
                log "RECOVERED: $service was restarted successfully"
            else
                log "FAILED: Unable to restart $service"
            fi
        fi
    done
}

# Main execution
log "=== Starting System Health Check ==="
check_cpu
check_memory
check_disk
check_services
log "=== System Health Check Complete ==="`,
                setup: `1. Save as /usr/local/bin/system_health_monitor.sh
2. chmod +x /usr/local/bin/system_health_monitor.sh
3. Add to crontab: */5 * * * * /usr/local/bin/system_health_monitor.sh
4. Configure email relay for alerts`,
                tags: ["monitoring", "health", "alerting", "system"]
            },
            {
                title: "Automated Backup System",
                category: "backup",
                difficulty: "advanced",
                description: "Complete backup solution with rotation and cloud sync",
                features: ["Database backup", "File system backup", "Compression", "Cloud storage sync", "Retention policy"],
                code: `#!/bin/bash
# backup_system.sh - Automated backup with rotation and cloud sync

set -euo pipefail

# Configuration
BACKUP_ROOT="/backups"
DB_USER="backup_user"
DB_PASSWORD="${DB_PASSWORD:-}"
DATABASES=("production" "staging")
BACKUP_DIRS=("/var/www" "/etc/nginx" "/home/deploy")
RETENTION_DAYS=30
S3_BUCKET="s3://company-backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

# Logging
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$BACKUP_ROOT/backup.log"
}

# Create backup directories
setup_directories() {
    mkdir -p "$BACKUP_ROOT/databases"
    mkdir -p "$BACKUP_ROOT/files"
    mkdir -p "$BACKUP_ROOT/logs"
}

# Database backup
backup_databases() {
    log "Starting database backups..."
    DB_BACKUP_DIR="$BACKUP_ROOT/databases/$TIMESTAMP"
    mkdir -p "$DB_BACKUP_DIR"
    
    for db in "${DATABASES[@]}"; do
        log "Backing up database: $db"
        
        # Create compressed backup
        mysqldump -u "$DB_USER" -p"$DB_PASSWORD" \
            --single-transaction \
            --quick \
            --lock-tables=false \
            --routines \
            --triggers \
            "$db" | gzip > "$DB_BACKUP_DIR/${db}_$TIMESTAMP.sql.gz"
        
        if [ $? -eq 0 ]; then
            log "âœ“ Database backup completed: $db"
            
            # Calculate checksum
            md5sum "$DB_BACKUP_DIR/${db}_$TIMESTAMP.sql.gz" > "$DB_BACKUP_DIR/${db}_$TIMESTAMP.md5"
        else
            log "âœ— Database backup failed: $db"
            exit 1
        fi
    done
}

# File system backup
backup_files() {
    log "Starting file system backups..."
    FILE_BACKUP_DIR="$BACKUP_ROOT/files/$TIMESTAMP"
    mkdir -p "$FILE_BACKUP_DIR"
    
    for dir in "${BACKUP_DIRS[@]}"; do
        if [ -d "$dir" ]; then
            log "Backing up directory: $dir"
            BASENAME=$(basename "$dir")
            
            # Create compressed tar archive
            tar -czf "$FILE_BACKUP_DIR/${BASENAME}_$TIMESTAMP.tar.gz" \
                --exclude="*.log" \
                --exclude="*.tmp" \
                --exclude="node_modules" \
                -C "$(dirname "$dir")" \
                "$BASENAME"
            
            if [ $? -eq 0 ]; then
                log "âœ“ Directory backup completed: $dir"
                
                # Calculate checksum
                md5sum "$FILE_BACKUP_DIR/${BASENAME}_$TIMESTAMP.tar.gz" > "$FILE_BACKUP_DIR/${BASENAME}_$TIMESTAMP.md5"
            else
                log "âœ— Directory backup failed: $dir"
            fi
        else
            log "âš  Directory not found: $dir"
        fi
    done
}

# Upload to S3
upload_to_s3() {
    if command -v aws &> /dev/null; then
        log "Uploading backups to S3..."
        
        # Upload with progress
        aws s3 sync "$BACKUP_ROOT/" "$S3_BUCKET/" \
            --storage-class STANDARD_IA \
            --progress
        
        if [ $? -eq 0 ]; then
            log "âœ“ S3 upload completed"
        else
            log "âœ— S3 upload failed"
        fi
    else
        log "âš  AWS CLI not found, skipping S3 upload"
    fi
}

# Cleanup old backups
cleanup_old_backups() {
    log "Cleaning up old backups (retention: $RETENTION_DAYS days)..."
    
    # Remove old local backups
    find "$BACKUP_ROOT/databases" -type d -mtime +$RETENTION_DAYS -exec rm -rf {} + 2>/dev/null
    find "$BACKUP_ROOT/files" -type d -mtime +$RETENTION_DAYS -exec rm -rf {} + 2>/dev/null
    
    # Remove old S3 backups (if AWS CLI is available)
    if command -v aws &> /dev/null; then
        aws s3 rm "$S3_BUCKET" --recursive --exclude "*" --include "*/databases/*" --older-than $RETENTION_DAYS
        aws s3 rm "$S3_BUCKET" --recursive --exclude "*" --include "*/files/*" --older-than $RETENTION_DAYS
    fi
    
    log "âœ“ Cleanup completed"
}

# Generate backup report
generate_report() {
    REPORT_FILE="$BACKUP_ROOT/backup_report_$TIMESTAMP.txt"
    
    cat > "$REPORT_FILE" << EOF
Backup Report - $(date)
========================

Backup Location: $BACKUP_ROOT
Timestamp: $TIMESTAMP
Databases Backed Up: ${DATABASES[*]}
Directories Backed Up: ${BACKUP_DIRS[*]}
Retention Policy: $RETENTION_DAYS days

Disk Usage:
$(df -h "$BACKUP_ROOT")

Backup Sizes:
$(du -sh "$BACKUP_ROOT/databases/$TIMESTAMP" "$BACKUP_ROOT/files/$TIMESTAMP" 2>/dev/null)
EOF

    log "Backup report generated: $REPORT_FILE"
}

# Main execution
main() {
    log "========================================="
    log "Starting backup process"
    log "========================================="
    
    setup_directories
    backup_databases
    backup_files
    upload_to_s3
    cleanup_old_backups
    generate_report
    
    log "========================================="
    log "Backup process completed successfully"
    log "========================================="
}

# Run main function
main`,
                setup: `1. Install AWS CLI and configure credentials
2. Set DB_PASSWORD environment variable
3. Create backup user with appropriate permissions
4. Schedule in crontab: 0 2 * * * /path/to/backup_system.sh
5. Configure S3 bucket with proper IAM permissions`,
                tags: ["backup", "database", "cloud", "automation", "retention"]
            },
            {
                title: "Zero-Downtime Deployment",
                category: "deployment",
                difficulty: "advanced",
                description: "Automated deployment script with health checks and rollback",
                features: ["Blue-green deployment", "Health checks", "Automatic rollback", "Load balancer updates", "Database migrations"],
                code: `#!/bin/bash
# zero_downtime_deploy.sh - Automated deployment with rollback

set -euo pipefail

# Configuration
APP_NAME="myapp"
DEPLOY_USER="deploy"
APP_DIR="/opt/apps/$APP_NAME"
REPO_URL="git@github.com:company/myapp.git"
BRANCH="${1:-main}"
ENVIRONMENT="${2:-production}"
HEALTH_CHECK_URL="http://localhost:3000/health"
SLACK_WEBHOOK="${SLACK_WEBHOOK:-}"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Logging functions
log() {
    echo -e "${GREEN}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[$(date '+%Y-%m-%d %H:%M:%S')] WARNING:${NC} $1"
}

error() {
    echo -e "${RED}[$(date '+%Y-%m-%d %H:%M:%S')] ERROR:${NC} $1"
}

# Slack notification
notify_slack() {
    local message=$1
    local color=${2:-"good"}
    
    if [ -n "$SLACK_WEBHOOK" ]; then
        curl -X POST "$SLACK_WEBHOOK" \
            -H 'Content-Type: application/json' \
            -d "{\"text\":\"$message\", \"color\":\"$color\"}" \
            --silent --show-error || true
    fi
}

# Health check function
health_check() {
    local attempts=0
    local max_attempts=10
    
    log "Performing health check..."
    
    while [ $attempts -lt $max_attempts ]; do
        if curl -f -s --max-time 10 "$HEALTH_CHECK_URL" > /dev/null; then
            log "âœ“ Health check passed"
            return 0
        else
            attempts=$((attempts + 1))
            warn "Health check attempt $attempts/$max_attempts failed, retrying..."
            sleep 5
        fi
    done
    
    error "Health check failed after $max_attempts attempts"
    return 1
}

# Rollback function
rollback() {
    error "Deployment failed, initiating rollback..."
    
    # Notify rollback start
    notify_slack "âš ï¸ Deployment rollback initiated for $APP_NAME" "warning"
    
    # Restore from backup
    if [ -d "$BACKUP_DIR" ]; then
        log "Restoring from backup: $BACKUP_DIR"
        rm -rf "$APP_DIR"
        cp -r "$BACKUP_DIR" "$APP_DIR"
        
        # Restart services
        systemctl restart "$APP_NAME" || true
        
        # Wait for service to be ready
        sleep 10
        
        if health_check; then
            log "âœ“ Rollback completed successfully"
            notify_slack "âœ… Rollback completed for $APP_NAME" "good"
        else
            error "Rollback failed, manual intervention required"
            notify_slack "ðŸš¨ CRITICAL: Rollback failed for $APP_NAME" "danger"
        fi
    else
        error "No backup available for rollback"
        notify_slack "ðŸš¨ CRITICAL: No backup available for rollback" "danger"
    fi
    
    exit 1
}

# Set up error handling
trap rollback ERR

# Main deployment function
main() {
    log "========================================="
    log "Starting deployment: $APP_NAME"
    log "Branch: $BRANCH"
    log "Environment: $ENVIRONMENT"
    log "========================================="
    
    # Notify deployment start
    notify_slack "ðŸš€ Starting deployment of $APP_NAME ($BRANCH) to $ENVIRONMENT"
    
    # Pre-deployment checks
    log "Performing pre-deployment checks..."
    
    # Check if required tools are available
    for tool in git npm systemctl; do
        if ! command -v $tool &> /dev/null; then
            error "Required tool not found: $tool"
            exit 1
        fi
    done
    
    # Check disk space
    AVAILABLE_SPACE=$(df "$APP_DIR" | awk 'NR==2 {print $4}')
    if [ "$AVAILABLE_SPACE" -lt 1048576 ]; then  # 1GB in KB
        warn "Low disk space available: ${AVAILABLE_SPACE}KB"
    fi
    
    # Create backup
    log "Creating backup of current version..."
    BACKUP_DIR="/opt/backups/$APP_NAME/$(date +%Y%m%d_%H%M%S)"
    mkdir -p "$BACKUP_DIR"
    
    if [ -d "$APP_DIR" ]; then
        cp -r "$APP_DIR" "$BACKUP_DIR/"
        log "âœ“ Backup created at $BACKUP_DIR"
    else
        log "No existing deployment to backup"
    fi
    
    # Clone or update repository
    if [ -d "$APP_DIR/.git" ]; then
        log "Updating existing repository..."
        cd "$APP_DIR"
        git fetch origin
        git checkout "$BRANCH"
        git pull origin "$BRANCH"
    else
        log "Cloning repository..."
        rm -rf "$APP_DIR"
        git clone -b "$BRANCH" "$REPO_URL" "$APP_DIR"
        cd "$APP_DIR"
    fi
    
    # Get commit info
    COMMIT_HASH=$(git rev-parse --short HEAD)
    COMMIT_MSG=$(git log -1 --pretty=%B)
    log "âœ“ Deployed commit: $COMMIT_HASH"
    
    # Install dependencies
    log "Installing dependencies..."
    npm install --production --silent
    
    # Run database migrations
    if [ -f "migrations/migrate.sh" ]; then
        log "Running database migrations..."
        chmod +x migrations/migrate.sh
        ./migrations/migrate.sh "$ENVIRONMENT"
    fi
    
    # Build application
    if [ -f "package.json" ] && grep -q "build:$ENVIRONMENT" package.json; then
        log "Building application..."
        npm run "build:$ENVIRONMENT"
    fi
    
    # Run tests
    if [ -f "package.json" ] && grep -q "test" package.json; then
        log "Running tests..."
        npm test
    fi
    
    # Pre-deployment health check
    if systemctl is-active --quiet "$APP_NAME"; then
        log "Current service is healthy, proceeding with deployment"
    fi
    
    # Deploy with zero downtime
    log "Deploying new version..."
    
    # Update service configuration if needed
    if [ -f "systemd/$APP_NAME.service" ]; then
        cp "systemd/$APP_NAME.service" "/etc/systemd/system/"
        systemctl daemon-reload
    fi
    
    # Restart with zero downtime (if using load balancer)
    if [ -f "deploy/nginx-switch.sh" ]; then
        log "Switching to new version..."
        ./deploy/nginx-switch.sh
    else
        log "Restarting service..."
        systemctl restart "$APP_NAME"
    fi
    
    # Wait for service to be ready
    sleep 10
    
    # Health check
    if health_check; then
        log "âœ“ Deployment completed successfully"
        
        # Cleanup old backups (keep last 5)
        log "Cleaning up old backups..."
        ls -t "/opt/backups/$APP_NAME" 2>/dev/null | tail -n +6 | xargs -I {} rm -rf "/opt/backups/$APP_NAME/{}"
        
        # Success notification
        notify_slack "âœ… Deployment of $APP_NAME completed successfully
        
Commit: $COMMIT_HASH
Environment: $ENVIRONMENT
Branch: $BRANCH" "good"
        
        log "========================================="
        log "âœ… Deployment completed successfully"
        log "Commit: $COMMIT_HASH"
        log "========================================="
    else
        error "Deployment failed health check"
        rollback
    fi
}

# Run deployment
main "$@"`,
                setup: `1. Configure SSH keys for repository access
2. Set up systemd service files
3. Configure load balancer (if using blue-green deployment)
4. Set up Slack webhook for notifications
5. Configure database migration scripts
6. Set up health check endpoints in application`,
                tags: ["deployment", "zero-downtime", "rollback", "health-check", "automation"]
            },
            {
                title: "Security Audit Script",
                category: "security",
                difficulty: "intermediate",
                description: "Automated security scanning and compliance checking",
                features: ["User account audit", "File permission checks", "Service security scan", "Log analysis", "Compliance reporting"],
                code: `#!/bin/bash
# security_audit.sh - Automated security audit and compliance

AUDIT_DIR="/var/log/security_audit"
REPORT_FILE="$AUDIT_DIR/audit_$(date +%Y%m%d_%H%M%S).json"
ALERT_EMAIL="security@company.com"

# Create audit directory
mkdir -p "$AUDIT_DIR"

# JSON report structure
cat > "$REPORT_FILE" << 'EOF'
{
  "timestamp": "",
  "hostname": "",
  "audit_results": {
    "user_accounts": {},
    "file_permissions": {},
    "services": {},
    "network_security": {},
    "compliance": {}
  }
}
EOF

# Logging function
log_audit() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$AUDIT_DIR/audit.log"
}

# Update JSON report
update_json() {
    local section="$1"
    local key="$2"
    local value="$3"
    
    # Use jq to update JSON (if available)
    if command -v jq &> /dev/null; then
        jq ".audit_results.$section[\"$key\"] = \"$value\"" "$REPORT_FILE" > temp.json && mv temp.json "$REPORT_FILE"
    fi
}

# Check user accounts
check_user_accounts() {
    log_audit "Checking user accounts..."
    
    # Check for users without passwords
    local users_without_password=$(awk -F: '($2 == "" || $2 == "*") {print $1}' /etc/shadow)
    if [ -n "$users_without_password" ]; then
        update_json "user_accounts" "users_without_password" "$users_without_password"
        log_audit "WARNING: Users without passwords found: $users_without_password"
    fi
    
    # Check for users with UID 0 (root privileges)
    local root_users=$(awk -F: '($3 == 0) {print $1}' /etc/passwd | grep -v root)
    if [ -n "$root_users" ]; then
        update_json "user_accounts" "non_root_uid0" "$root_users"
        log_audit "WARNING: Non-root users with UID 0: $root_users"
    fi
    
    # Check for inactive accounts (no login in last 90 days)
    local inactive_users=$(lastlog -b 90 | grep -v "Username" | awk '{print $1}')
    if [ -n "$inactive_users" ]; then
        update_json "user_accounts" "inactive_90_days" "$inactive_users"
        log_audit "INFO: Inactive users (90+ days): $inactive_users"
    fi
    
    # Check password policy
    local min_days=$(grep "^PASS_MIN_DAYS" /etc/login.defs | awk '{print $2}')
    local max_days=$(grep "^PASS_MAX_DAYS" /etc/login.defs | awk '{print $2}')
    
    if [ "$min_days" -lt 7 ]; then
        log_audit "WARNING: PASS_MIN_DAYS is less than 7"
    fi
    
    if [ "$max_days" -gt 90 ]; then
        log_audit "WARNING: PASS_MAX_DAYS is greater than 90"
    fi
}

# Check file permissions
check_file_permissions() {
    log_audit "Checking critical file permissions..."
    
    # Check /etc/passwd permissions
    if [ "$(stat -c %a /etc/passwd)" != "644" ]; then
        update_json "file_permissions" "etc_passwd" "incorrect"
        log_audit "WARNING: /etc/passwd has incorrect permissions"
    fi
    
    # Check /etc/shadow permissions
    if [ "$(stat -c %a /etc/shadow)" != "640" ]; then
        update_json "file_permissions" "etc_shadow" "incorrect"
        log_audit "WARNING: /etc/shadow has incorrect permissions"
    fi
    
    # Check for world-writable files in /etc
    local world_writable=$(find /etc -type f -perm -002 2>/dev/null)
    if [ -n "$world_writable" ]; then
        update_json "file_permissions" "world_writable_etc" "found"
        log_audit "WARNING: World-writable files found in /etc"
    fi
    
    # Check for SUID files
    local suid_files=$(find / -type f -perm -4000 2>/dev/null | grep -v '/proc')
    if [ -n "$suid_files" ]; then
        log_audit "INFO: SUID files found (review manually)"
        echo "$suid_files" > "$AUDIT_DIR/suid_files_$(date +%Y%m%d).txt"
    fi
}

# Check service security
check_service_security() {
    log_audit "Checking service security..."
    
    # Check for services running as root
    local root_services=$(ps aux | grep -v '\[' | awk '$1 == "root" {print $11}' | sort -u)
    if [ -n "$root_services" ]; then
        log_audit "INFO: Services running as root (review): $root_services"
    fi
    
    # Check SSH configuration
    if [ -f "/etc/ssh/sshd_config" ]; then
        # Check if root login is disabled
        if grep -q "^PermitRootLogin no" /etc/ssh/sshd_config; then
            update_json "services" "ssh_root_login" "disabled"
            log_audit "âœ“ SSH root login is disabled"
        else
            update_json "services" "ssh_root_login" "enabled"
            log_audit "WARNING: SSH root login is enabled"
        fi
        
        # Check if password authentication is disabled
        if grep -q "^PasswordAuthentication no" /etc/ssh/sshd_config; then
            update_json "services" "ssh_password_auth" "disabled"
            log_audit "âœ“ SSH password authentication is disabled"
        else
            update_json "services" "ssh_password_auth" "enabled"
            log_audit "WARNING: SSH password authentication is enabled"
        fi
    fi
    
    # Check for insecure services
    local insecure_services=("telnet" "ftp" "rsh" "rlogin")
    for service in "${insecure_services[@]}"; do
        if systemctl is-active --quiet "$service"; then
            log_audit "WARNING: Insecure service $service is active"
        fi
    done
}

# Check network security
check_network_security() {
    log_audit "Checking network security..."
    
    # Check for open ports
    local open_ports=$(netstat -tuln | grep LISTEN | awk '{print $4}' | cut -d: -f2 | sort -n)
    if [ -n "$open_ports" ]; then
        log_audit "INFO: Listening ports: $open_ports"
        echo "$open_ports" > "$AUDIT_DIR/listening_ports_$(date +%Y%m%d).txt"
    fi
    
    # Check firewall status
    if command -v ufw &> /dev/null; then
        if ufw status | grep -q "Status: active"; then
            update_json "network_security" "firewall_ufw" "active"
            log_audit "âœ“ UFW firewall is active"
        else
            update_json "network_security" "firewall_ufw" "inactive"
            log_audit "WARNING: UFW firewall is inactive"
        fi
    elif command -v firewall-cmd &> /dev/null; then
        if firewall-cmd --state &> /dev/null; then
            update_json "network_security" "firewall_firewalld" "active"
            log_audit "âœ“ Firewalld is active"
        else
            update_json "network_security" "firewall_firewalld" "inactive"
            log_audit "WARNING: Firewalld is inactive"
        fi
    fi
}

# Generate compliance report
generate_compliance_report() {
    log_audit "Generating compliance report..."
    
    # Update basic info
    if command -v jq &> /dev/null; then
        jq ".timestamp = \"$(date -Iseconds)\"" "$REPORT_FILE" > temp.json && mv temp.json "$REPORT_FILE"
        jq ".hostname = \"$(hostname)\"" "$REPORT_FILE" > temp.json && mv temp.json "$REPORT_FILE"
    fi
    
    # Generate summary
    local total_issues=0
    local critical_issues=0
    
    # Count issues from log
    total_issues=$(grep -c "WARNING:" "$AUDIT_DIR/audit.log" || echo 0)
    critical_issues=$(grep -c "CRITICAL:" "$AUDIT_DIR/audit.log" || echo 0)
    
    # Create summary report
    cat > "$AUDIT_DIR/summary_$(date +%Y%m%d).txt" << EOF
Security Audit Summary
======================
Date: $(date)
Hostname: $(hostname)
Total Issues: $total_issues
Critical Issues: $critical_issues

Audit Files:
- Detailed Report: $REPORT_FILE
- Log File: $AUDIT_DIR/audit.log
- SUID Files: $AUDIT_DIR/suid_files_$(date +%Y%m%d).txt
- Listening Ports: $AUDIT_DIR/listening_ports_$(date +%Y%m%d).txt

Recommendations:
1. Review all WARNING messages in the log
2. Address critical issues immediately
3. Regularly review SUID files
4. Monitor listening ports
5. Ensure proper firewall configuration
EOF

    log_audit "Compliance report generated"
    
    # Send alert if critical issues found
    if [ "$critical_issues" -gt 0 ]; then
        echo "Critical security issues found on $(hostname). Review $AUDIT_DIR/summary_$(date +%Y%m%d).txt" | \
            mail -s "Security Alert: Critical Issues Found" "$ALERT_EMAIL" 2>/dev/null || true
    fi
}

# Main execution
main() {
    log_audit "Starting security audit..."
    
    check_user_accounts
    check_file_permissions
    check_service_security
    check_network_security
    generate_compliance_report
    
    log_audit "Security audit completed"
    log_audit "Reports available in: $AUDIT_DIR"
}

# Run audit
main "$@"`,
                setup: `1. Install required tools: jq, mailutils, net-tools
2. Configure email for alerts
3. Set up audit user with sudo permissions
4. Schedule regular audits via cron
5. Review and customize security policies`,
                tags: ["security", "audit", "compliance", "monitoring", "reporting"]
            }
        ];

        let currentFilter = 'all';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            renderExamples();
            setupEventListeners();
            setupScrollAnimations();
        });

        function setupEventListeners() {
            // Filter buttons
            document.querySelectorAll('.scenario-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.scenario-filter').forEach(b => {
                        b.classList.remove('active');
                        b.classList.add('text-gray-400');
                    });
                    this.classList.add('active');
                    this.classList.remove('text-gray-400');
                    
                    currentFilter = this.dataset.filter;
                    renderExamples();
                });
            });

            // Copy buttons and expand/collapse
            document.addEventListener('click', function(e) {
                if (e.target.closest('.copy-btn')) {
                    const code = e.target.closest('.copy-btn').dataset.code;
                    copyToClipboard(code);
                }
                
                if (e.target.closest('.expand-btn')) {
                    const btn = e.target.closest('.expand-btn');
                    const targetId = btn.dataset.target;
                    const content = document.getElementById(targetId);
                    
                    if (content.classList.contains('expanded')) {
                        content.classList.remove('expanded');
                        btn.textContent = 'Show Full Script';
                    } else {
                        content.classList.add('expanded');
                        btn.textContent = 'Hide Script';
                    }
                }
            });
        }

        function renderExamples() {
            const grid = document.getElementById('examples-grid');
            const filteredExamples = currentFilter === 'all' 
                ? examples 
                : examples.filter(ex => ex.category === currentFilter);
            
            grid.innerHTML = filteredExamples.map(example => `
                <div class="example-card p-8 rounded-lg fade-in">
                    <div class="flex items-start justify-between mb-6">
                        <div class="flex-1">
                            <h3 class="text-2xl font-bold text-green-400 mb-2">${example.title}</h3>
                            <p class="text-gray-400 mb-4">${example.description}</p>
                            <div class="flex items-center space-x-4 mb-4">
                                <span class="difficulty-badge difficulty-${example.difficulty}">${example.difficulty}</span>
                                <div class="flex space-x-2">
                                    ${example.tags.map(tag => `<span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">${tag}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                        <button class="copy-btn text-gray-400 hover:text-green-400 ml-4" data-code="${example.code.replace(/"/g, '&quot;')}">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/>
                                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-white mb-3">Features</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            ${example.features.map(feature => `
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                    <span class="text-sm text-gray-300">${feature}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-lg font-semibold text-white">Script</h4>
                            <button class="expand-btn px-4 py-2 rounded-lg text-sm font-medium" data-target="code-${example.title.replace(/\s+/g, '-')}">
                                Show Full Script
                            </button>
                        </div>
                        <div id="code-${example.title.replace(/\s+/g, '-')}" class="collapsible-content">
                            <pre><code class="language-bash">${example.code}</code></pre>
                        </div>
                    </div>
                    
                    <div class="bg-gray-900 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-3">Setup Instructions</h4>
                        <pre class="text-sm text-gray-300 whitespace-pre-wrap">${example.setup}</pre>
                    </div>
                </div>
            `).join('');
            
            // Trigger fade-in animations
            setTimeout(() => {
                document.querySelectorAll('.fade-in').forEach(el => {
                    el.classList.add('visible');
                });
            }, 100);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // Show feedback
                const originalHTML = event.target.closest('.copy-btn').innerHTML;
                event.target.closest('.copy-btn').innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>';
                setTimeout(() => {
                    event.target.closest('.copy-btn').innerHTML = originalHTML;
                }, 2000);
            });
        }

        function setupScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.fade-in').forEach(el => {
                observer.observe(el);
            });
        }
    </script>
</body>
</html>